---
title: "基于人工免疫的入侵检测系统"
description: ""
pubDate: 2026-01-06 14:50
tags:
  - "仿生免疫"
  - "入侵检测"
  - "系统架构"
# heroImage: "../assets/your-hero.png"
---

《An artificial immunity based intrusion detection system for unknown cyberattacks》提出了一种名为HiDE-IDS的基于分层差分进化的入侵检测系统，旨在解决传统入侵检测系统难以识别未知网络攻击的问题。该系统受人工免疫机制启发，通过将网络流量映射为多维几何空间中的抗原，利用分层差分进化算法从正常数据（自我抗原）演化出可能位于未知区域的异常数据（非自我抗原），并结合新型过滤机制生成有效的检测器，从而实现对已知及未知攻击的高效检测。

## 问题形式化与数据表示

该研究首先构建了基于人工免疫理论的问题模型，将多维网络流量数据映射为几何空间中的点，称为“抗原”。在此模型中，正常网络行为被定义为“自我抗原”（Self Antigens），而异常攻击行为被定义为“非自我抗原”（Nonself Antigens）。

### 抗原的定义与归一化
设训练数据集包含正常样本集合 $S_{train}$ 和异常样本集合 $N_{train}$。每一个样本被表示为一个 $d$ 维向量。为了消除不同特征维度的量纲差异，研究采用最大最小归一化方法处理数据。对于第 $x$ 维特征，归一化后的自我抗原 $\tilde{g}_s$ 和非自我抗原 $\tilde{g}_{ns}$ 计算如下：

$$
\tilde{f}_s^{i,x} = \frac{f_s^{i,x} - f_{min}^x}{f_{max}^x - f_{min}^x}, \quad \tilde{f}_{ns}^{j,x} = \frac{f_{ns}^{j,x} - f_{min}^x}{f_{max}^x - f_{min}^x}
$$

其中，$f_s^{i,x}$ 和 $f_{ns}^{j,x}$ 分别表示第 $i$ 个自我抗原和第 $j$ 个非自我抗原在第 $x$ 维的原始值，$f_{max}^x$ 和 $f_{min}^x$ 分别是训练集中该维度的最大值和最小值。

### 自我区域与边界定义
为了区分正常与异常，定义了“自我区域”（Self Region, $R_s$）。每个自我抗原 $g_s$ 覆盖一个半径为 $r_s$ 的超球体（Suprasphere），所有训练集中自我抗原覆盖区域的并集构成了自我区域：

$$
R_s = \bigcup_{g_s^i \in S_{train}} R_{g_s^i}
$$

任何落在 $R_s$ 之外的点被视为非自我抗原。$r_s$ 是一个关键参数，它不仅定义了正常行为的容忍边界，还能在训练数据不完全时提供鲁棒性。位于自我区域边缘、最接近非自我区域的自我抗原被定义为“边界自我抗原”（Boundary Self Antigens），这些抗原是后续进化算法的初始种群。

## 分层差分进化算法设计

为了生成能够覆盖未知攻击区域的检测器，该研究设计了一种分层差分进化算法（Hierarchical Differential Evolution）。该算法的核心思想并非直接使用随机生成的检测器，而是从边界自我抗原出发，通过变异和编辑操作，使其“跳出”自我区域，演化成为分布在未知区域的非自我抗原。

### 种群初始化与边界选择
算法的每一代进化都始于边界自我抗原。对于任意非自我抗原 $g_{ns}$（无论是训练集中的还是新演化出的），在 $S_{train}$ 中距离其最近的自我抗原被选为边界自我抗原 $g_{bs}$：

$$
g_{bs}^{(t),j} = \arg \min_{g_s^i \in S_{train}} \| g_{ns}^{(t),j} - g_s^i \|_2
$$

这些边界抗原构成了第 $t$ 代的初始种群 $G_{ini}^{(t)}$。这种选择策略确保了进化过程总是从最接近潜在攻击区域的正常数据边缘开始。

### 分层变异策略
为了探索距离自我区域不同远近的未知空间，算法引入了分层放大因子 $r_{mu}$。变异操作基于差分进化（DE）思想，利用训练集中已知的非自我抗原的方向差异来引导进化方向。变异向量 $v_{mu}$ 的计算公式为：

$$
v_{mu}^{(t),k} = r_{mu} \times \frac{(g_{ini}^{(t),k} - g_s^{i,k}) + (g_{ns}^{1,k} - g_{ns}^{2,k})}{\| (g_{ini}^{(t),k} - g_s^{i,k}) + (g_{ns}^{1,k} - g_{ns}^{2,k}) \|_2}
$$

这里，$g_{ini}^{(t),k}$ 是当前的边界自我抗原，$g_s^{i,k}$ 是另一自我抗原，$g_{ns}^{1,k}$ 和 $g_{ns}^{2,k}$ 是随机选取的两个不同的已知非自我抗原。公式中的分母用于单位化向量，而分子中的第二项 $(g_{ns}^{1,k} - g_{ns}^{2,k})$引入了随机扰动以增加多样性。

关键在于放大因子 $r_{mu}$ 被设计为分层的，即 $r_s < r_{mu}^1 < r_{mu}^2 < \dots < r_{mu}^{n_r}$。第 $l$ 层的放大因子按指数级增长：

$$
r_{mu}^l = \Delta \alpha^{(l-1)} \times r_{mu}^1
$$

其中 $\Delta \alpha > 1$ 是倍增系数。这种分层设计使得生成的抗原能够由近及远地覆盖自我区域周围的空白区域，从而有效地探测潜在的未知攻击。

### 受体编辑机制
由于仅沿直线方向变异可能导致新抗原陷入局部区域，算法引入了受体编辑（Receptor Editing）操作。该操作通过旋转矩阵 $M$ 对部分变异后的抗原进行几何旋转，使其沿弧线路径移动，从而跳出局部聚集区：

$$
G_{edit}^{(t), \tau_{ro}} = (G_{sub-mu}^{(t)} - C_{ro}) \times M_{ro}^{(t), \tau_{ro}} + C_{ro}
$$

其中，$C_{ro}$ 是旋转中心（所有训练自我抗原的中心），$G_{sub-mu}^{(t)}$ 是待编辑的抗原子集。这一步骤显著增加了演化抗原在空间分布上的多样性。

## 过滤机制与检测器生成

演化产生的新抗原（Evolved Antigens）必须经过严格的过滤才能用于生成检测器。该过程旨在消除无效抗原并减少检测器之间的冗余重叠，从而提高系统效率。

### 检测器生成规则
每个通过过滤的演化抗原将被作为检测器的中心。检测器被定义为超球体，其半径由该中心到最近的训练自我抗原的距离决定，以确保检测器不覆盖任何自我区域（即不产生误报）。对于中心为 $g_{ns}$ 的检测器，其半径 $r_{ns}$ 计算如下：

$$
r_{ns}^{(t),j} = \min_{g_s^i \in S_{train}} \| g_{ns}^{(t),j} - g_s^i \|_2 - r_s
$$

该公式确保了检测器与自我区域的边界至少保持 $r_s$ 的距离，即检测器与自我区域互不相交。

### 双重过滤机制
为了保证生成检测器的质量，算法实施了基于检测器（Detector-based）和基于自我抗原（Self-antigen-based）的两级过滤：

1.  **基于检测器的过滤**：此步骤旨在避免新生成的检测器与已有检测器过度重叠。如果一个新抗原 $g_{evo}$ 落入已有检测器 $D_{ns}$ 的覆盖范围内，且其带来的新覆盖面积（由夹角衡量）不足，则该抗原被丢弃。过滤条件涉及计算新抗原与已有检测器中心相对于最近自我抗原的夹角 $\theta_{fil}$：

    $$
    \cos(\theta^{(t),j | (t), m}) = \frac{(g_s - g_{ns}^{(t),j}) \cdot (g_{evo}^{(t),m} - g_{ns}^{(t),j})}{\| g_s - g_{ns}^{(t),j} \|_2 \times \| g_{evo}^{(t),m} - g_{ns}^{(t),j} \|_2}
    $$

    若计算出的夹角对应的重叠程度超过阈值，则认为该新抗原冗余。

2.  **基于自我抗原的过滤**：此步骤确保新抗原确实位于自我区域之外。只有当新抗原到所有训练自我抗原的最小距离大于自我半径 $r_s$ 时，该抗原才被保留：

    $$
    \min_{g_s^i \in S_{train}} \| g_{fil}^{(t),w} - g_s^i \|_2 > r_s
    $$

    这保证了所有生成的检测器均位于非自我空间，从而维持较低的误报率。

## 算法执行与检测属性

### 训练终止条件
HiDE-IDS 的训练过程是迭代的。每一代生成的抗原经过过滤后转化为检测器，并更新下一代的边界自我抗原。迭代过程在满足以下任一条件时终止：
1.  **过滤率阈值**：当基于检测器的过滤率 $\rho_{fil}$ 超过预设阈值（如90%）时，表明现有检测器已充分覆盖了非自我区域。
2.  **无新边界抗原**：当无法找到新的边界自我抗原作为下一代的进化起点时，表明搜索已充分完成。

### 攻击检测流程
在测试阶段，测试样本同样被映射为 $d$ 维抗原 $\tilde{g}_{test}$。检测逻辑分为两部分：
1.  **检测器覆盖**：如果测试抗原落入任何一个已生成的检测器 $D_{sum}$ 的覆盖范围内（即距离检测器中心小于等于检测器半径），则被判定为非自我（攻击）。
2.  **超出检测范围**：考虑到未知攻击可能与正常行为差异极大，系统定义了最大可检测范围（由最大放大因子 $r_{mu}^{n_r}$ 决定）。如果测试抗原超出了这一范围（即距离极远），直接判定为非自我抗原。

该机制使得 HiDE-IDS 不仅能够识别特征相似的已知攻击，还能通过覆盖广泛的非自我空间及处理离群点，有效识别特征迥异的未知攻击。